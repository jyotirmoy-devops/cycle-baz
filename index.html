<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyclebaz - Live MVP</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- FIREBASE SDK (Added for Auth) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ⚠️ CONFIGURATION: PASTE YOUR RENDER URL HERE ⚠️ ---
        // Example: "https://cyclebaz-api.onrender.com"
        // Do NOT add a trailing slash "/"
        const API_BASE_URL = "https://cyclebaz-api.onrender.com"; 

        // --- ICONS ---
        const Icons = {
            Search: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            MapPin: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Filter: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
            Menu: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            X: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Camera: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
            ShieldCheck: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>,
            AlertTriangle: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
            Heart: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            User: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Phone: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            Star: ({size=20, className, fill="none"}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            ChevronRight: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Bike: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2"/><path d="M5.5 14a3.8 3.8 0 0 1-1.3-.2"/></svg>,
            Wrench: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>,
            LogIn: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>,
            Grid: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>,
            Trash: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            CheckCircle: ({size=20, className}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        };

        const Badge = ({ children, className }) => (
            <span className={`px-2 py-0.5 rounded text-xs font-medium ${className}`}>{children}</span>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-md p-6 relative animate-fade-in-up">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                            <Icons.X size={24} />
                        </button>
                        <h2 className="text-xl font-bold mb-4">{title}</h2>
                        {children}
                    </div>
                </div>
            );
        };

        function CyclebazApp() {
            const [view, setView] = useState('browse');
            const [userRole, setUserRole] = useState('Guest'); 
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [listings, setListings] = useState([]); // Default empty, fetching from API
            const [isLoading, setIsLoading] = useState(true);
            const [filters, setFilters] = useState({ city: 'All', type: 'All', zone: 'All' });
            
            // Auth States
            const [phoneNumber, setPhoneNumber] = useState('');
            const [otp, setOtp] = useState('');
            const [otpStep, setOtpStep] = useState('PHONE'); 
            const [confirmationResult, setConfirmationResult] = useState(null);
            const [loadingAuth, setLoadingAuth] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            // --- FETCH LIVE DATA ---
            useEffect(() => {
                const fetchListings = async () => {
                    setIsLoading(true);
                    try {
                        let url = `${API_BASE_URL}/listings`;
                        const params = new URLSearchParams();
                        if (filters.city !== 'All') params.append('city', filters.city);
                        if (filters.type !== 'All') params.append('type', filters.type);
                        if (filters.zone !== 'All') params.append('zone', filters.zone);
                        
                        if (params.toString()) url += `?${params.toString()}`;

                        const response = await fetch(url);
                        if (!response.ok) throw new Error("Network response was not ok");
                        
                        const data = await response.json();
                        
                        // Transform DB data to UI format
                        const formattedData = data.map(item => ({
                            id: item._id, // Mongo ID
                            type: item.type,
                            category: item.category,
                            brand: item.brand,
                            model: item.model,
                            condition: item.condition,
                            price: item.price,
                            city: item.city,
                            zone: item.zone,
                            sellerType: item.owner_role,
                            isSuperSeller: item.owner_role === 'Super Seller',
                            sellerName: item.owner_role === 'Super Seller' ? 'Verified Shop' : 'Cyclebaz Seller', // Placeholder until we link User names
                            shopName: item.shop_name || 'Verified Shop',
                            image: item.image_url || 'https://via.placeholder.com/400x300?text=No+Image',
                            features: item.features || [],
                            postedDate: new Date(item.posted_at).toLocaleDateString()
                        }));

                        setListings(formattedData);
                    } catch (error) {
                        console.error("Failed to fetch listings:", error);
                        // If API fails, maybe we are local or offline?
                    } finally {
                        setIsLoading(false);
                    }
                };

                if (API_BASE_URL !== "YOUR_RENDER_URL_HERE") {
                    fetchListings();
                } else {
                    console.warn("Please set your Render URL in the code!");
                    setIsLoading(false);
                }
            }, [filters]); // Refetch when filters change

            // Initialize Recaptcha
            useEffect(() => {
                if (!window.recaptchaVerifier && window.firebase && firebase.apps.length) {
                    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                        'size': 'invisible'
                    });
                }
            }, []);

            // --- AUTH LOGIC ---
            const requestOtp = () => {
                if (!phoneNumber || phoneNumber.length < 10) return alert("Invalid phone");
                
                if (typeof firebase === 'undefined' || !firebase.apps.length) {
                    alert("DEMO MODE: Simulating OTP sent to " + phoneNumber);
                    setOtpStep('VERIFY');
                    return;
                }

                setLoadingAuth(true);
                const appVerifier = window.recaptchaVerifier;
                const formattedPhone = phoneNumber.startsWith('+') ? phoneNumber : '+91' + phoneNumber;

                firebase.auth().signInWithPhoneNumber(formattedPhone, appVerifier)
                    .then((result) => {
                        setConfirmationResult(result);
                        setOtpStep('VERIFY');
                        setLoadingAuth(false);
                    }).catch((error) => {
                        console.error(error);
                        alert("Error: " + error.message);
                        setLoadingAuth(false);
                    });
            };

            const verifyOtp = () => {
                if (typeof firebase === 'undefined' || !firebase.apps.length) {
                    setUserRole('Buyer'); setShowLoginModal(false); setOtpStep('PHONE'); return;
                }

                if (!confirmationResult) return;
                setLoadingAuth(true);
                confirmationResult.confirm(otp).then((result) => {
                    setUserRole('Buyer');
                    setShowLoginModal(false);
                    setOtpStep('PHONE');
                    setLoadingAuth(false);
                }).catch((error) => {
                    alert("Invalid OTP");
                    setLoadingAuth(false);
                });
            };

            const handleListingAction = (action) => {
                if (userRole === 'Guest') {
                    setShowLoginModal(true);
                } else {
                    if (action === 'contact') {
                        alert("Redirecting to WhatsApp...");
                    }
                }
            };

            // Post Listing (Connected to Backend Placeholder)
            const handlePostListing = async (e) => {
                e.preventDefault();
                alert("To implement: POST request to " + API_BASE_URL + "/listings");
                setView('browse');
            };

            // Render Dashboard (Simplified for MVP)
            const renderDashboard = () => {
                if (userRole === 'Guest') return <div className="text-center py-20"><Icons.LogIn className="mx-auto h-12 w-12 text-gray-300 mb-4"/><h2 className="text-xl font-bold">Please Login</h2><button onClick={() => setShowLoginModal(true)} className="bg-green-600 text-white px-6 py-2 rounded-full font-bold mt-4">Login Now</button></div>;
                return <div className="bg-white p-6 rounded-xl border border-gray-200"><h2 className="text-lg font-bold">Welcome, {userRole}</h2><p className="text-gray-500">Connected to: {API_BASE_URL}</p></div>;
            };

            return (
                <div className="min-h-screen bg-gray-50 font-sans text-gray-800">
                    <div id="recaptcha-container"></div>
                    
                    {/* Header Bar */}
                    <div className="bg-slate-800 text-white p-2 text-xs flex flex-col md:flex-row justify-between items-center sticky top-0 z-50 gap-2">
                        <span className="font-mono text-green-400">Cyclebaz Live • {listings.length} items loaded</span>
                        <div className="flex items-center gap-2"><span>Simulate Role:</span><select value={userRole} onChange={(e) => setUserRole(e.target.value)} className="bg-slate-700 border border-slate-600 rounded px-2 py-1 text-white"><option value="Guest">Guest</option><option value="Buyer">Buyer</option><option value="Seller">Individual Seller</option><option value="Super Seller">Super Seller</option><option value="Admin">Admin</option></select></div>
                    </div>

                    <header className="bg-white shadow-sm sticky top-10 z-40">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                {/* Logo */}
                                <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('browse')}>
                                    <div className="bg-green-600 text-white p-1.5 rounded-lg"><Icons.Bike size={24} /></div>
                                    <span className="text-xl font-bold tracking-tight text-green-800">Cyclebaz</span>
                                </div>
                                {/* Desktop Nav */}
                                <nav className="hidden md:flex items-center gap-8">
                                    <button onClick={() => setView('browse')} className={`text-sm font-medium ${view === 'browse' ? 'text-green-600' : 'text-gray-500 hover:text-gray-900'}`}>Buy Cycles</button>
                                    <button onClick={() => setView('sell')} className={`text-sm font-medium ${view === 'sell' ? 'text-green-600' : 'text-gray-500 hover:text-gray-900'}`}>Sell Now</button>
                                    {userRole !== 'Guest' && <button onClick={() => setView('dashboard')} className={`text-sm font-medium ${view === 'dashboard' ? 'text-green-600' : 'text-gray-500 hover:text-gray-900'}`}>Dashboard</button>}
                                </nav>
                                {/* Auth/Profile */}
                                <div className="hidden md:flex items-center gap-4">{userRole === 'Guest' ? <button onClick={() => setShowLoginModal(true)} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2"><Icons.LogIn size={16} /> Login / Signup</button> : <div className="flex items-center gap-2"><div className="bg-green-100 text-green-800 p-2 rounded-full"><Icons.User size={20} /></div><div className="flex flex-col"><span className="text-xs font-medium text-gray-500">Logged in as</span><span className="text-sm font-bold leading-none">{userRole}</span></div></div>}</div>
                                {/* Mobile Menu Button */}
                                <button className="md:hidden p-2 text-gray-600" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}><Icons.Menu size={24} /></button>
                            </div>
                        </div>
                        {/* Mobile Menu */}
                        {mobileMenuOpen && (
                            <div className="md:hidden bg-white border-t p-4 space-y-4">
                                <button onClick={() => { setView('browse'); setMobileMenuOpen(false); }} className="block w-full text-left font-medium text-gray-700">Buy Cycles</button>
                                <button onClick={() => { setView('sell'); setMobileMenuOpen(false); }} className="block w-full text-left font-medium text-gray-700">Sell Now</button>
                                <button onClick={() => { setShowLoginModal(true); setMobileMenuOpen(false); }} className="block w-full text-left font-medium text-green-600">Login / Signup</button>
                            </div>
                        )}
                    </header>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                        {view === 'browse' && (
                            <div className="space-y-6">
                                {/* Search & Filters */}
                                <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div className="relative col-span-2"><Icons.Search className="absolute left-3 top-3 text-gray-400" size={20} /><input type="text" placeholder="Search..." className="w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-200 outline-none" /></div>
                                        <div className="relative"><Icons.MapPin className="absolute left-3 top-3 text-gray-400" size={20} /><select className="w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-200 outline-none bg-white" value={filters.city} onChange={(e) => setFilters({...filters, city: e.target.value})}><option value="All">All Cities</option><option value="Delhi">Delhi</option><option value="Mumbai">Mumbai</option><option value="Bangalore">Bangalore</option><option value="Hyderabad">Hyderabad</option></select></div>
                                        <div className="relative"><Icons.Filter className="absolute left-3 top-3 text-gray-400" size={20} /><select className="w-full pl-10 pr-4 py-2.5 rounded-lg border border-gray-200 outline-none bg-white" value={filters.zone} onChange={(e) => setFilters({...filters, zone: e.target.value})}><option value="All">All Zones</option><option value="North">North</option><option value="South">South</option><option value="East">East</option><option value="West">West</option><option value="Central">Central</option></select></div>
                                    </div>
                                </div>

                                {/* Loading State */}
                                {isLoading && <div className="text-center py-20 text-gray-500">Loading live data from server...</div>}

                                {/* Listings Grid */}
                                {!isLoading && (
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                        {listings.map((item) => (
                                            <div key={item.id} className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow flex flex-col">
                                                <div className="relative h-48 bg-gray-200 overflow-hidden group">
                                                    {item.isSuperSeller && <div className="absolute top-2 left-2 z-10 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded shadow flex items-center gap-1"><Icons.Star size={12} fill="currentColor" /> SUPER SELLER</div>}
                                                    <img src={item.image} className={`w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 ${userRole === 'Guest' ? 'blur-sm scale-110' : ''}`} onError={(e)=>{e.target.src='https://via.placeholder.com/400x300?text=No+Image'}} />
                                                    {userRole === 'Guest' && <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-20"><Badge className="bg-black bg-opacity-60 text-white backdrop-blur-md">Login to View</Badge></div>}
                                                    <button className="absolute top-2 right-2 p-1.5 bg-white rounded-full text-gray-400 hover:text-red-500 shadow-sm"><Icons.Heart size={18} /></button>
                                                </div>
                                                <div className="p-4 flex flex-col flex-grow">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <p className="text-xs font-medium text-gray-500 uppercase tracking-wide">{item.brand}</p>
                                                            <h3 className="font-bold text-lg text-gray-900 truncate">{item.model}</h3>
                                                        </div>
                                                    </div>
                                                    <div className="flex flex-wrap gap-1 mb-4">
                                                        <Badge className="bg-gray-100 text-gray-600">{item.condition}</Badge>
                                                        <Badge className="bg-green-50 text-green-700 flex items-center gap-1"><Icons.MapPin size={10} /> {item.city} ({item.zone})</Badge>
                                                    </div>
                                                    <div className="text-xs text-gray-500 mb-4 space-y-1">
                                                        {item.features.slice(0, 2).map((feat, idx) => (<div key={idx} className="flex items-center gap-1"><div className="w-1 h-1 rounded-full bg-gray-400"></div> {feat}</div>))}
                                                    </div>
                                                    <div className="mt-auto pt-4 border-t border-gray-50 flex items-center justify-between">
                                                        <div>
                                                            <p className="text-xs text-gray-400 mb-0.5">Asking Price</p>
                                                            <span className={`text-xl font-bold ${userRole === 'Guest' ? 'text-gray-400' : 'text-green-700'}`}>{userRole === 'Guest' ? '₹ XX,XXX' : `₹ ${item.price.toLocaleString()}`}</span>
                                                        </div>
                                                        <button onClick={() => handleListingAction('contact')} className={`px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2 ${userRole === 'Guest' ? 'bg-gray-900 text-white hover:bg-gray-800' : 'bg-green-600 text-white hover:bg-green-700'}`}>{userRole === 'Guest' ? <>Unlock <Icons.ChevronRight size={16} /></> : <><Icons.Phone size={16} /> Contact</>}</button>
                                                    </div>
                                                    {userRole !== 'Guest' && (
                                                        <div className="mt-3 flex justify-between items-center">
                                                            <span className="text-xs text-gray-500 flex items-center gap-1"><Icons.User size={12} /> {item.isSuperSeller ? item.shopName : item.sellerName}</span>
                                                            <button onClick={() => alert("Seller reported.")} className="text-[10px] text-red-500 hover:underline flex items-center gap-1"><Icons.AlertTriangle size={10} /> Seller not responding?</button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        {view === 'dashboard' && renderDashboard()}
                        {view === 'sell' && (
                            <div className="max-w-2xl mx-auto">
                                <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 sm:p-8">
                                    <div className="text-center mb-8"><h2 className="text-2xl font-bold text-gray-900">List your Item</h2><p className="text-gray-500 mt-2">Reach thousands of buyers in your city</p></div>
                                    {userRole === 'Seller' && <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-6 flex items-start gap-3"><div className="bg-orange-100 p-1 rounded text-orange-600 mt-0.5"><Icons.AlertTriangle size={16} /></div><div><h4 className="text-sm font-bold text-orange-800">Limit: 1/3 used</h4><p className="text-xs text-orange-700 mt-1">Upgrade to Super Seller for unlimited posts.</p></div></div>}
                                    <form className="space-y-6" onSubmit={handlePostListing}>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Model Name</label><input type="text" className="w-full rounded-lg border-gray-300 border p-2.5 focus:ring-2 focus:ring-green-500 outline-none" placeholder="e.g. Rockrider ST100" /></div>
                                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Price (₹)</label><input type="number" className="w-full rounded-lg border-gray-300 border p-2.5 focus:ring-2 focus:ring-green-500 outline-none" placeholder="0" /></div>
                                        </div>
                                        <button type="submit" className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-green-200">Post Listing</button>
                                    </form>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Auth Modal */}
                    <Modal isOpen={showLoginModal} onClose={() => setShowLoginModal(false)} title="Login to Cyclebaz">
                        <div className="space-y-4">
                            <p className="text-sm text-gray-600">{otpStep === 'PHONE' ? 'Enter mobile number for OTP verification.' : 'Enter the 6-digit code sent to your phone.'}</p>
                            {otpStep === 'PHONE' ? (
                                <div>
                                    <div className="flex mb-4">
                                        <span className="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">+91</span>
                                        <input type="tel" className="block w-full rounded-none rounded-r-lg border-gray-300 border p-2.5 focus:ring-2 focus:ring-green-500 outline-none text-sm" placeholder="98765 43210" value={phoneNumber} onChange={e => setPhoneNumber(e.target.value)} />
                                    </div>
                                    <button onClick={requestOtp} disabled={loadingAuth} className="w-full bg-green-600 text-white font-bold py-2.5 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2">{loadingAuth ? 'Sending...' : 'Get OTP'} <Icons.ChevronRight size={16} /></button>
                                </div>
                            ) : (
                                <div>
                                    <input type="text" className="w-full border p-2.5 rounded-lg mb-4 text-center tracking-widest text-xl font-bold" placeholder="123456" maxLength={6} value={otp} onChange={e => setOtp(e.target.value)} />
                                    <button onClick={verifyOtp} disabled={loadingAuth} className="w-full bg-green-600 text-white font-bold py-2.5 rounded-lg flex items-center justify-center gap-2">{loadingAuth ? 'Verifying...' : 'Verify & Login'}</button>
                                    <p className="text-center text-xs text-blue-500 mt-2 cursor-pointer" onClick={() => setOtpStep('PHONE')}>Change Number</p>
                                </div>
                            )}
                        </div>
                    </Modal>
                </div>
            );
        }

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
            // apiKey: "...",
            // authDomain: "...",
            // projectId: "...",
            // storageBucket: "...",
            // messagingSenderId: "...",
            // appId: "..."
        };

        if (firebaseConfig.apiKey) {
            firebase.initializeApp(firebaseConfig);
        } else {
            console.log("Firebase config missing. Running in DEMO mode.");
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CyclebazApp />);
    </script>
</body>
</html>
